<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smash or Pass - Cesaris Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        /* Menu Laterale */
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }
        
        .sidebar.active {
            left: 0;
        }
        
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .sidebar-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .sidebar-nav {
            list-style: none;
        }
        
        .sidebar-nav li {
            margin-bottom: 10px;
        }
        
        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: #333;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background: #2a5298;
            color: white;
        }
        
        .sidebar-nav i {
            margin-right: 10px;
            font-size: 18px;
        }
        
        .menu-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2a5298;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .cesaris {
            color: #FFD700;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }

        /* Stili per i passaggi di upload */
        .upload-steps {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 20px;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ddd;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .step.active .step-number {
            background: #2a5298;
        }
        
        .step.completed .step-number {
            background: #4CAF50;
        }
        
        .step-content {
            display: none;
            text-align: center;
        }
        
        .step-content.active {
            display: block;
        }
        
        .gender-selection {
            margin: 20px 0;
        }
        
        .gender-btn {
            background: #f0f0f0;
            border: 2px solid #ddd;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            min-width: 150px;
        }
        
        .gender-btn.active {
            background: #2a5298;
            color: white;
            border-color: #2a5298;
        }
        
        .gender-btn.male.active {
            background: #1e3c72;
            border-color: #1e3c72;
        }
        
        .gender-btn.female.active {
            background: #FFD700;
            color: #333;
            border-color: #FFD700;
        }
        
        .upload-area {
            border: 2px dashed #2a5298;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover {
            background-color: #f8f9ff;
        }
        
        .upload-area i {
            font-size: 48px;
            color: #2a5298;
            margin-bottom: 15px;
        }
        
        .preview-container {
            margin: 20px 0;
            text-align: center;
        }
        
        .preview-image {
            max-width: 300px;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .btn-primary {
            background: #2a5298;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #1e3c72;
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #ddd;
        }
        
        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        #fileInput {
            display: none;
        }
        
        /* Stili per la votazione */
        .voting-interface {
            text-align: center;
        }
        
        .gender-selection-vote {
            margin: 20px 0;
        }
        
        .photo-container {
            position: relative;
            max-width: 400px;
            margin: 0 auto 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .current-photo {
            width: 100%;
            height: 500px;
            object-fit: cover;
            display: block;
        }
        
        .vote-buttons-single {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .smash-btn-single, .pass-btn-single {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .smash-btn-single {
            background: #4CAF50;
            color: white;
        }
        
        .smash-btn-single:hover {
            background: #45a049;
            transform: scale(1.05);
        }
        
        .pass-btn-single {
            background: #f44336;
            color: white;
        }
        
        .pass-btn-single:hover {
            background: #da190b;
            transform: scale(1.05);
        }
        
        .progress-container-single {
            margin: 20px auto;
            max-width: 400px;
        }
        
        .progress-bar-single {
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .progress-fill {
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .progress-fill.smash {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
        }
        
        .progress-fill.pass {
            background: linear-gradient(90deg, #f44336, #ff9800);
        }
        
        .stats-single {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .smash-stat {
            color: #4CAF50;
        }
        
        .pass-stat {
            color: #f44336;
        }
        
        /* Stili per la cronologia */
        .vote-history {
            margin-top: 30px;
            text-align: left;
        }
        
        .history-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            background: #f9f9f9;
            margin-bottom: 10px;
            border-radius: 8px;
        }
        
        .history-photo {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
            margin-right: 15px;
        }
        
        .history-info {
            flex-grow: 1;
        }
        
        .history-vote {
            font-weight: bold;
            padding: 8px 15px;
            border-radius: 20px;
            margin-left: 10px;
        }
        
        .history-vote.smash {
            background: #4CAF50;
            color: white;
        }
        
        .history-vote.pass {
            background: #f44336;
            color: white;
        }
        
        .change-vote-btn {
            background: #FFD700;
            color: #333;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            font-weight: bold;
        }
        
        .no-photos {
            text-align: center;
            padding: 40px;
            color: #777;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: #2a5298;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #777;
        }
        
        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            color: #ddd;
        }
        
        .history-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .history-filter {
            display: flex;
            gap: 10px;
        }
        
        .filter-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .filter-btn.active {
            background: #2a5298;
            color: white;
            border-color: #2a5298;
        }
        
        /* Stili per la classifica */
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            background: #f9f9f9;
            margin-bottom: 10px;
            border-radius: 8px;
        }
        
        .leaderboard-rank {
            font-size: 24px;
            font-weight: bold;
            margin-right: 15px;
            color: #2a5298;
            min-width: 30px;
            text-align: center;
        }
        
        .leaderboard-photo {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
            margin-right: 15px;
        }
        
        .leaderboard-info {
            flex-grow: 1;
        }
        
        .leaderboard-score {
            font-weight: bold;
            color: #4CAF50;
            margin-right: 10px;
        }
        
        .info-btn {
            background: #2a5298;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* Stili per i modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }
        
        /* Stili per gli achievement */
        .achievement-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            background: #f9f9f9;
            margin-bottom: 10px;
            border-radius: 8px;
        }
        
        .achievement-icon {
            font-size: 24px;
            margin-right: 15px;
        }
        
        .achievement-info {
            flex-grow: 1;
        }
        
        .achievement-locked {
            opacity: 0.5;
        }
        
        /* Stili per le animazioni */
        .smash-effect {
            animation: smashPulse 0.6s ease;
        }
        
        .pass-effect {
            animation: passSlide 0.6s ease;
        }
        
        @keyframes smashPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes passSlide {
            0% { transform: translateX(0); }
            50% { transform: translateX(-20px); }
            100% { transform: translateX(0); }
        }
        
        /* Stili per il sistema di report */
        .report-status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .report-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .report-approved {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .report-rejected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Stili per le notifiche in tempo reale */
        .live-stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .live-stat {
            text-align: center;
        }
        
        .live-stat-number {
            font-size: 24px;
            font-weight: bold;
        }
        
        .live-stat-label {
            font-size: 14px;
            color: #666;
        }
        
        /* Stili per l'admin panel */
        .admin-panel {
            margin-top: 30px;
        }
        
        .reported-photo {
            border: 2px solid #ff9800;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            background: #fff9e6;
        }
        
        .admin-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .admin-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .approve-btn {
            background: #4CAF50;
            color: white;
        }
        
        .reject-btn {
            background: #f44336;
            color: white;
        }
        
        .suspended-badge {
            background: #ff9800;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        /* Stili per la protezione admin */
        .admin-protection {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
        }
        
        .admin-login-form {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .password-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .admin-only {
            display: none;
        }
        
        .admin-only.authenticated {
            display: block;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .gender-btn {
                padding: 12px 20px;
                font-size: 16px;
                min-width: 130px;
                margin: 5px;
            }
            
            .upload-area {
                padding: 30px 15px;
            }
            
            .preview-image {
                max-width: 100%;
                max-height: 300px;
            }
            
            .photo-container {
                max-width: 100%;
            }
            
            .current-photo {
                height: 400px;
            }
            
            .vote-buttons-single {
                gap: 10px;
            }
            
            .smash-btn-single, .pass-btn-single {
                padding: 12px 20px;
                font-size: 16px;
                min-width: 100px;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 200px;
                margin: 5px 0;
            }
            
            .history-item {
                flex-direction: column;
                text-align: center;
            }
            
            .history-photo {
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .leaderboard-item {
                flex-direction: column;
                text-align: center;
            }
            
            .leaderboard-photo {
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .live-stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .sidebar {
                width: 280px;
                left: -280px;
            }
            
            .tab-content {
                padding: 20px 15px;
            }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #4CAF50;
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: #f44336;
        }
        
        .notification.warning {
            background: #ff9800;
        }
        
        .notification.info {
            background: #2196F3;
        }

        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .no-context-menu {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .debug-info {
            background: #f8f9fa;
            border-left: 4px solid #2a5298;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .settings-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="no-select no-context-menu" oncontextmenu="return false;">
    <!-- Menu Laterale -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>Navigazione</h3>
            <button class="sidebar-close" onclick="toggleSidebar()">√ó</button>
        </div>
        <ul class="sidebar-nav">
            <li><a href="#" onclick="switchTab('upload')" class="nav-link active" data-tab="upload">üì§ Carica Foto</a></li>
            <li><a href="#" onclick="switchTab('vote')" class="nav-link" data-tab="vote">üó≥Ô∏è Vota Foto</a></li>
            <li><a href="#" onclick="switchTab('history')" class="nav-link" data-tab="history">üìä Cronologia</a></li>
            <li><a href="#" onclick="switchTab('leaderboard')" class="nav-link" data-tab="leaderboard">üèÜ Classifica</a></li>
            <li><a href="#" onclick="switchTab('achievements')" class="nav-link" data-tab="achievements">üéØ Achievement</a></li>
            
            <!-- Solo se admin autenticato -->
            <li class="admin-only" id="adminNavItem">
                <a href="#" onclick="switchTab('admin')" class="nav-link" data-tab="admin">üõ°Ô∏è Moderazione</a>
            </li>
            
            <li><a href="#" onclick="switchTab('settings')" class="nav-link" data-tab="settings">‚öôÔ∏è Impostazioni</a></li>
        </ul>
    </div>
    
    <!-- Overlay per chiudere il menu -->
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
    
    <!-- Bottone per aprire il menu -->
    <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
    
    <div class="container">
        <header>
            <h1>Smash or Pass <span class="cesaris">Cesaris Edition</span></h1>
            <p>Carica la tua foto anonimamente e vota le foto degli altri!</p>
        </header>
        
        <!-- Contenuto delle tabs -->
        <div class="tab-content active" id="upload-tab">
            <!-- Indicatore dei passaggi -->
            <div class="upload-steps">
                <div class="step active" id="step1">
                    <div class="step-number">1</div>
                    <div>Scegli Genere</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <div>Carica Foto</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div>Conferma</div>
                </div>
            </div>
            
            <!-- Passaggio 1: Scelta genere -->
            <div class="step-content active" id="step1-content">
                <h3>Step 1: Seleziona il genere</h3>
                <p>Scegli se stai caricando una foto di un ragazzo o una ragazza</p>
                
                <div class="gender-selection">
                    <button class="gender-btn male" data-gender="male" id="maleBtn">
                        üë¶ Ragazzo
                    </button>
                    <button class="gender-btn female" data-gender="female" id="femaleBtn">
                        üëß Ragazza
                    </button>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="goToStep(2)" id="nextToStep2" disabled>
                        Avanti
                    </button>
                </div>
            </div>
            
            <!-- Passaggio 2: Caricamento foto -->
            <div class="step-content" id="step2-content">
                <h3>Step 2: Carica la tua foto</h3>
                <p id="selected-gender-text">Stai caricando una foto di: <strong id="current-gender"></strong></p>
                
                <div class="upload-area" id="uploadArea">
                    <i>üì∑</i>
                    <h3>Clicca qui per selezionare una foto</h3>
                    <p>Oppure trascina il file qui</p>
                    <p style="font-size: 14px; color: #666; margin-top: 10px;">Dimensione massima: 5MB</p>
                    <input type="file" id="fileInput" accept="image/*">
                </div>
                
                <div class="preview-container">
                    <img id="previewImage" class="preview-image" alt="Anteprima" style="display: none;">
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="goToStep(1)">
                        Indietro
                    </button>
                    <button class="btn btn-primary" onclick="goToStep(3)" id="nextToStep3" disabled>
                        Avanti
                    </button>
                </div>
            </div>
            
            <!-- Passaggio 3: Conferma -->
            <div class="step-content" id="step3-content">
                <h3>Step 3: Conferma il caricamento</h3>
                
                <div class="preview-container">
                    <img id="confirmPreviewImage" class="preview-image" alt="Anteprima conferma">
                </div>
                
                <p><strong>Genere:</strong> <span id="confirm-gender"></span></p>
                <p style="color: #666; margin: 15px 0;">Controlla che tutto sia corretto prima di procedere</p>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="goToStep(2)">
                        Modifica
                    </button>
                    <button class="btn btn-primary" onclick="uploadPhoto()" id="uploadBtn">
                        üöÄ Carica Foto
                    </button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="vote-tab">
            <div class="voting-interface">
                <div class="gender-selection-vote">
                    <h3>Su chi vuoi votare?</h3>
                    <button class="gender-btn male active" data-gender="male" id="voteMaleBtn">
                        üë¶ Ragazzi
                    </button>
                    <button class="gender-btn female" data-gender="female" id="voteFemaleBtn">
                        üëß Ragazze
                    </button>
                </div>
                
                <!-- Statistiche in tempo reale -->
                <div class="live-stats" id="liveStats" style="display: none;">
                    <div class="live-stat">
                        <div class="live-stat-number" id="liveSmash">0</div>
                        <div class="live-stat-label">SMASH</div>
                    </div>
                    <div class="live-stat">
                        <div class="live-stat-number" id="livePass">0</div>
                        <div class="live-stat-label">PASS</div>
                    </div>
                    <div class="live-stat">
                        <div class="live-stat-number" id="liveTotal">0</div>
                        <div class="live-stat-label">TOTALE</div>
                    </div>
                </div>
                
                <div id="singlePhotoView">
                    <div class="loading" id="loadingIndicator">
                        Caricamento foto in corso...
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="history-tab">
            <div class="vote-history">
                <div class="history-controls">
                    <h3>La tua cronologia voti</h3>
                    <div class="history-filter">
                        <button class="filter-btn active" onclick="filterHistory('all')">Tutti</button>
                        <button class="filter-btn" onclick="filterHistory('smash')">Smash</button>
                        <button class="filter-btn" onclick="filterHistory('pass')">Pass</button>
                    </div>
                </div>
                
                <div id="historyList">
                    <div class="loading">Caricamento cronologia...</div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="leaderboard-tab">
            <div class="vote-history">
                <div class="history-controls">
                    <h3>Classifica Foto pi√π Popolari</h3>
                    <div class="history-filter">
                        <button class="filter-btn active" onclick="filterLeaderboard('all')">Tutti</button>
                        <button class="filter-btn" onclick="filterLeaderboard('male')">Ragazzi</button>
                        <button class="filter-btn" onclick="filterLeaderboard('female')">Ragazze</button>
                    </div>
                </div>
                
                <div id="leaderboardList">
                    <div class="loading">Caricamento classifica...</div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="achievements-tab">
            <div class="vote-history">
                <h3>I Tuoi Achievement</h3>
                <p>Sblocca achievement completando diverse azioni nell'app!</p>
                
                <div id="achievementsList">
                    <div class="loading">Caricamento achievement...</div>
                </div>
            </div>
        </div>
        
        <!-- Tab per moderazione admin (PROTETTA) -->
        <div class="tab-content admin-only" id="admin-tab">
            <div class="admin-protection" id="adminLoginSection">
                <h2>üîê Accesso Amministratore</h2>
                <p>Questa sezione √® riservata all'amministratore.</p>
                <div class="admin-login-form">
                    <input type="password" id="adminPassword" class="password-input" placeholder="Inserisci la password admin">
                    <button class="btn btn-primary" onclick="authenticateAdmin()" style="width: 100%;">
                        üîë Accedi
                    </button>
                </div>
            </div>
            
            <div class="admin-panel" id="adminPanel" style="display: none;">
                <h2>üõ°Ô∏è Pannello di Moderazione</h2>
                <p>Qui puoi gestire le foto segnalate dagli utenti.</p>
                
                <div class="settings-section">
                    <h3>Foto Segnalate</h3>
                    <div id="reportedPhotosList">
                        <div class="loading">Caricamento foto segnalate...</div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Foto Sospese</h3>
                    <p>Foto temporaneamente sospese in attesa di revisione</p>
                    <div id="suspendedPhotosList">
                        <div class="loading">Caricamento foto sospese...</div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Statistiche Moderazione</h3>
                    <div id="moderationStats">
                        <div class="loading">Caricamento statistiche...</div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="logoutAdmin()">
                        üö™ Esci
                    </button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="settings-tab">
            <div class="settings-section">
                <h3>Importa/Esporta Dati</h3>
                <p>Salva i tuoi dati locali o importa dati precedenti</p>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="exportData()">
                        üì• Esporta Dati
                    </button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">
                        üì§ Importa Dati
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                </div>
            </div>
            
            <div class="settings-section">
                <h3>Scorciatoie da Tastiera</h3>
                <p>Usa queste scorciatoie durante la votazione:</p>
                <ul>
                    <li><strong>Freccia Sinistra / A:</strong> Vota PASS</li>
                    <li><strong>Freccia Destra / D:</strong> Vota SMASH</li>
                    <li><strong>Spazio:</strong> Salta foto</li>
                </ul>
            </div>
            
            <div class="settings-section">
                <h3>Informazioni</h3>
                <p>Versione: 2.0</p>
                <p>Foto totali caricate: <span id="totalPhotos">0</span></p>
                <p>Voti totali: <span id="totalVotes">0</span></p>
            </div>
        </div>
    </div>

    <!-- Modal per informazioni foto -->
    <div class="modal" id="photoInfoModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Informazioni Foto</h3>
                <button class="close-modal" onclick="closeModal('photoInfoModal')">√ó</button>
            </div>
            <div id="photoInfoContent">
                <!-- Contenuto dinamico -->
            </div>
        </div>
    </div>
    
    <!-- Modal per segnalazione -->
    <div class="modal" id="reportModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Segnala Foto</h3>
                <button class="close-modal" onclick="closeModal('reportModal')">√ó</button>
            </div>
            <div id="reportContent">
                <p>Seleziona il motivo della segnalazione:</p>
                <select id="reportReason" class="password-input" style="width: 100%; margin-bottom: 15px;">
                    <option value="inappropriate">Contenuto inappropriato</option>
                    <option value="sexual">Contenuto sessuale</option>
                    <option value="fake">Foto non reale/falsa</option>
                    <option value="other">Altro</option>
                </select>
                <textarea id="reportDetails" class="password-input" placeholder="Dettagli aggiuntivi (opzionale)" style="width: 100%; height: 100px; margin-bottom: 15px;"></textarea>
                <button class="btn btn-primary" onclick="submitReport()" style="width: 100%;">Invia Segnalazione</button>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>

    <script>
        // üî• SOSTITUISCI QUESTI VALORI CON I TUOI DI SUPABASE!
        const SUPABASE_URL = 'https://rreyuxxnyhhahwkjxfiv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJyZXl1eHhueWhoYWh3a2p4Zml2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMjIyNDgsImV4cCI6MjA3ODU5ODI0OH0.F_ZnqK10o8h-IY23_g9RzkPHqQVbpAvjQmw0awlApBE';
        
        // Inizializza Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Variabili globali
        let selectedGender = null;
        let selectedFile = null;
        let currentVoteGender = 'male';
        let currentPhotos = [];
        let currentPhotoIndex = 0;
        let voteHistory = JSON.parse(localStorage.getItem('voteHistory') || '{}');
        let currentHistoryFilter = 'all';
        let currentLeaderboardFilter = 'all';
        let achievements = JSON.parse(localStorage.getItem('achievements') || '{}');
        let currentPhotoForReport = null;
        
        // üîê SISTEMA DI SICUREZZA ADMIN - La password viene generata dinamicamente
        // In un'applicazione reale, questa logica dovrebbe essere sul server
        let isAdminAuthenticated = localStorage.getItem('adminAuthenticated') === 'true';
        const ADMIN_SALT = 'smash-or-pass-cesaris-2024'; // Cambia questo salt!
        
        // Funzione per generare hash semplice (solo per dimostrazione)
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return hash.toString();
        }
        
        // La password √® calcolata dinamicamente, non hardcoded
        function getAdminPassword() {
            // In un'applicazione reale, questa logica dovrebbe essere sul server
            const baseString = ADMIN_SALT + new Date().toISOString().split('T')[0];
            return simpleHash(baseString).substring(0, 8);
        }
        
        // Soglia per sospensione automatica
        const REPORT_THRESHOLD = 3;
        
        // Inizializza l'applicazione
        document.addEventListener('DOMContentLoaded', function() {
            initEventListeners();
            loadPhotosForVoting();
            loadAchievements();
            loadStats();
            checkAdminAuth();
        });
        
        // Gestione Menu Laterale
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }
        
        function switchTab(tabName) {
            // Chiudi il menu laterale su mobile
            if (window.innerWidth <= 768) {
                toggleSidebar();
            }
            
            // Nascondi tutti i tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Mostra il tab selezionato
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Aggiorna i link nel menu laterale
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-tab') === tabName) {
                    link.classList.add('active');
                }
            });
            
            // Carica contenuti specifici
            if (tabName === 'vote') {
                loadPhotosForVoting();
            } else if (tabName === 'history') {
                loadVoteHistory();
            } else if (tabName === 'leaderboard') {
                loadLeaderboard();
            } else if (tabName === 'achievements') {
                loadAchievementsDisplay();
            } else if (tabName === 'admin') {
                // Se non autenticato, mostra il login
                if (!isAdminAuthenticated) {
                    document.getElementById('adminLoginSection').style.display = 'block';
                    document.getElementById('adminPanel').style.display = 'none';
                } else {
                    document.getElementById('adminLoginSection').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'block';
                    loadReportedPhotos();
                    loadSuspendedPhotos();
                    loadModerationStats();
                }
            } else if (tabName === 'settings') {
                loadStats();
            }
        }
        
        // Inizializza tutti gli event listener
        function initEventListeners() {
            // Gestione selezione genere per upload
            document.getElementById('maleBtn').addEventListener('click', function() {
                selectGender('male');
            });
            
            document.getElementById('femaleBtn').addEventListener('click', function() {
                selectGender('female');
            });
            
            // Gestione selezione genere per votazione
            document.getElementById('voteMaleBtn').addEventListener('click', function() {
                selectVoteGender('male');
            });
            
            document.getElementById('voteFemaleBtn').addEventListener('click', function() {
                selectVoteGender('female');
            });
            
            // Gestione selezione file
            document.getElementById('fileInput').addEventListener('change', function(e) {
                if (e.target.files.length) {
                    handleFileSelection(e.target.files[0]);
                }
            });
            
            // Gestione import file
            document.getElementById('importFile').addEventListener('change', function(e) {
                if (e.target.files.length) {
                    importData(e.target.files[0]);
                }
            });
            
            // Gestione drag and drop
            const uploadArea = document.getElementById('uploadArea');
            
            uploadArea.addEventListener('click', function() {
                document.getElementById('fileInput').click();
            });
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.backgroundColor = '#f0f4ff';
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.backgroundColor = '';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.backgroundColor = '';
                
                if (e.dataTransfer.files.length) {
                    handleFileSelection(e.dataTransfer.files[0]);
                }
            });
            
            // Scorciatoie da tastiera
            document.addEventListener('keydown', function(e) {
                // Solo se siamo nella tab di votazione
                if (document.getElementById('vote-tab').classList.contains('active')) {
                    switch(e.key) {
                        case 'ArrowLeft':
                        case 'a':
                        case 'A':
                            voteCurrentPhoto('pass');
                            break;
                        case 'ArrowRight':
                        case 'd':
                        case 'D':
                            voteCurrentPhoto('smash');
                            break;
                        case ' ':
                            e.preventDefault();
                            // Salta la foto corrente
                            currentPhotoIndex++;
                            showCurrentPhoto();
                            break;
                    }
                }
            });
        }
        
        // üîê SISTEMA DI AUTENTICAZIONE ADMIN
        function checkAdminAuth() {
            const adminElements = document.querySelectorAll('.admin-only');
            const adminNavItem = document.getElementById('adminNavItem');
            
            if (isAdminAuthenticated) {
                // Mostra elementi admin
                adminElements.forEach(el => el.classList.add('authenticated'));
            } else {
                // Nascondi elementi admin
                adminElements.forEach(el => el.classList.remove('authenticated'));
            }
        }
        
        function authenticateAdmin() {
            const passwordInput = document.getElementById('adminPassword');
            const enteredPassword = passwordInput.value;
            
            // Genera la password del giorno
            const todayPassword = getAdminPassword();
            
            if (enteredPassword === todayPassword) {
                isAdminAuthenticated = true;
                localStorage.setItem('adminAuthenticated', 'true');
                showNotification('Accesso admin effettuato!', false, 'info');
                checkAdminAuth();
                
                // Se siamo nella tab admin, ricarica i dati
                if (document.getElementById('admin-tab').classList.contains('active')) {
                    document.getElementById('adminLoginSection').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'block';
                    loadReportedPhotos();
                    loadSuspendedPhotos();
                    loadModerationStats();
                }
                
                // Resetta il campo password
                passwordInput.value = '';
            } else {
                showNotification('Password errata!', true);
                passwordInput.value = '';
                passwordInput.focus();
            }
        }
        
        function logoutAdmin() {
            isAdminAuthenticated = false;
            localStorage.removeItem('adminAuthenticated');
            showNotification('Disconnessione admin effettuata.', false, 'info');
            checkAdminAuth();
            
            // Se siamo nella tab admin, torna alla home
            if (document.getElementById('admin-tab').classList.contains('active')) {
                switchTab('upload');
            }
        }
        
        // üìä STATISTICHE MODERAZIONE
        async function loadModerationStats() {
            const moderationStats = document.getElementById('moderationStats');
            
            try {
                // Conta foto attive
                const { data: activePhotos, error: activeError } = await supabase
                    .from('photos')
                    .select('id', { count: 'exact' })
                    .eq('status', 'active');
                
                // Conta foto sospese
                const { data: suspendedPhotos, error: suspendedError } = await supabase
                    .from('photos')
                    .select('id', { count: 'exact' })
                    .eq('status', 'suspended');
                
                // Conta report totali
                const { data: totalReports, error: reportsError } = await supabase
                    .from('reports')
                    .select('id', { count: 'exact' });
                
                if (activeError || suspendedError || reportsError) {
                    throw new Error('Errore nel caricamento delle statistiche');
                }
                
                moderationStats.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; text-align: center;">
                        <div style="background: #d4edda; padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #155724;">${activePhotos.length || 0}</div>
                            <div style="color: #155724;">Foto Attive</div>
                        </div>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #856404;">${suspendedPhotos.length || 0}</div>
                            <div style="color: #856404;">Foto Sospese</div>
                        </div>
                        <div style="background: #f8d7da; padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #721c24;">${totalReports.length || 0}</div>
                            <div style="color: #721c24;">Report Totali</div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Errore nel caricamento delle statistiche:', error);
                moderationStats.innerHTML = '<div class="empty-state"><p>Errore nel caricamento delle statistiche</p></div>';
            }
        }
        
        // üõ°Ô∏è SISTEMA DI REPORT E MODERAZIONE
        
        // Carica le foto segnalate
        async function loadReportedPhotos() {
            if (!isAdminAuthenticated) return;
            
            const reportedPhotosList = document.getElementById('reportedPhotosList');
            reportedPhotosList.innerHTML = '<div class="loading">Caricamento foto segnalate...</div>';
            
            try {
                // Ottieni le foto con report_count > 0 e status active
                const { data: photos, error } = await supabase
                    .from('photos')
                    .select('*')
                    .gt('report_count', 0)
                    .eq('status', 'active')
                    .order('report_count', { ascending: false });
                
                if (error) throw error;
                
                if (!photos || photos.length === 0) {
                    reportedPhotosList.innerHTML = '<div class="empty-state"><p>Nessuna foto segnalata</p></div>';
                    return;
                }
                
                reportedPhotosList.innerHTML = photos.map(photo => {
                    const totalVotes = photo.smash_count + photo.pass_count;
                    const smashPercentage = totalVotes > 0 ? 
                        Math.round((photo.smash_count / totalVotes) * 100) : 0;
                    
                    return `
                        <div class="reported-photo">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <img src="${photo.image_url}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 10px; margin-right: 15px;">
                                <div style="flex-grow: 1;">
                                    <h4>${photo.gender === 'male' ? 'üë¶ Ragazzo' : 'üëß Ragazza'}</h4>
                                    <p><strong>Segnalazioni:</strong> ${photo.report_count || 0}</p>
                                    <p><strong>Smash:</strong> ${photo.smash_count} | <strong>Pass:</strong> ${photo.pass_count}</p>
                                    <p><strong>Caricata il:</strong> ${new Date(photo.created_at).toLocaleDateString()}</p>
                                </div>
                            </div>
                            
                            <div class="admin-actions">
                                <button class="admin-btn approve-btn" onclick="approvePhoto('${photo.id}')">‚úÖ Approva</button>
                                <button class="admin-btn reject-btn" onclick="rejectPhoto('${photo.id}')">‚ùå Rimuovi</button>
                                <button class="btn btn-secondary" onclick="suspendPhoto('${photo.id}')">‚è∏Ô∏è Sospendi</button>
                                <button class="btn btn-secondary" onclick="showPhotoReports('${photo.id}')">üìã Report</button>
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Errore nel caricamento delle foto segnalate:', error);
                reportedPhotosList.innerHTML = '<div class="empty-state"><p>Errore nel caricamento delle foto segnalate</p></div>';
            }
        }
        
        // Carica le foto sospese
        async function loadSuspendedPhotos() {
            if (!isAdminAuthenticated) return;
            
            const suspendedPhotosList = document.getElementById('suspendedPhotosList');
            suspendedPhotosList.innerHTML = '<div class="loading">Caricamento foto sospese...</div>';
            
            try {
                // Ottieni le foto con status = 'suspended'
                const { data: photos, error } = await supabase
                    .from('photos')
                    .select('*')
                    .eq('status', 'suspended')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                if (!photos || photos.length === 0) {
                    suspendedPhotosList.innerHTML = '<div class="empty-state"><p>Nessuna foto sospesa</p></div>';
                    return;
                }
                
                suspendedPhotosList.innerHTML = photos.map(photo => {
                    const totalVotes = photo.smash_count + photo.pass_count;
                    const smashPercentage = totalVotes > 0 ? 
                        Math.round((photo.smash_count / totalVotes) * 100) : 0;
                    
                    return `
                        <div class="reported-photo">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <img src="${photo.image_url}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 10px; margin-right: 15px;">
                                <div>
                                    <h4>${photo.gender === 'male' ? 'üë¶ Ragazzo' : 'üëß Ragazza'} <span class="suspended-badge">SOSPESA</span></h4>
                                    <p><strong>Segnalazioni:</strong> ${photo.report_count || 0}</p>
                                    <p><strong>Smash:</strong> ${photo.smash_count} | <strong>Pass:</strong> ${photo.pass_count}</p>
                                    <p><strong>Caricata il:</strong> ${new Date(photo.created_at).toLocaleDateString()}</p>
                                </div>
                            </div>
                            <div class="admin-actions">
                                <button class="admin-btn approve-btn" onclick="approvePhoto('${photo.id}')">‚úÖ Riattiva</button>
                                <button class="admin-btn reject-btn" onclick="rejectPhoto('${photo.id}')">‚ùå Elimina</button>
                                <button class="btn btn-secondary" onclick="showPhotoReports('${photo.id}')">üìã Report</button>
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Errore nel caricamento delle foto sospese:', error);
                suspendedPhotosList.innerHTML = '<div class="empty-state"><p>Errore nel caricamento delle foto sospese</p></div>';
            }
        }
        
        // Approva una foto (rimuove le segnalazioni)
        async function approvePhoto(photoId) {
            if (!isAdminAuthenticated) {
                showNotification('Accesso admin richiesto!', true);
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('photos')
                    .update({ 
                        report_count: 0,
                        status: 'active'
                    })
                    .eq('id', photoId);
                
                if (error) throw error;
                
                // Segna i report come risolti
                await supabase
                    .from('reports')
                    .update({ resolved: true })
                    .eq('photo_id', photoId);
                
                showNotification('Foto approvata con successo!');
                
                // Ricarica le liste
                loadReportedPhotos();
                loadSuspendedPhotos();
                loadModerationStats();
                
            } catch (error) {
                console.error('Errore durante l\'approvazione:', error);
                showNotification('Errore durante l\'approvazione. Riprova.', true);
            }
        }
        
        // Sospendi una foto manualmente
        async function suspendPhoto(photoId) {
            if (!isAdminAuthenticated) {
                showNotification('Accesso admin richiesto!', true);
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('photos')
                    .update({ 
                        status: 'suspended'
                    })
                    .eq('id', photoId);
                
                if (error) throw error;
                
                showNotification('Foto sospesa con successo!');
                
                // Ricarica le liste
                loadReportedPhotos();
                loadSuspendedPhotos();
                loadModerationStats();
                
            } catch (error) {
                console.error('Errore durante la sospensione:', error);
                showNotification('Errore durante la sospensione. Riprova.', true);
            }
        }
        
        // Mostra tutti i report di una foto
        async function showPhotoReports(photoId) {
            if (!isAdminAuthenticated) {
                showNotification('Accesso admin richiesto!', true);
                return;
            }
            
            try {
                const { data: reports, error } = await supabase
                    .from('reports')
                    .select('*')
                    .eq('photo_id', photoId)
                    .order('reported_at', { ascending: false });
                
                if (error) throw error;
                
                const reportsHtml = reports.map(report => `
                    <div style="border-left: 3px solid #ff9800; padding: 10px; margin: 10px 0; background: #f8f9fa; border-radius: 5px;">
                        <strong>${getReasonText(report.reason)}</strong>
                        ${report.details ? `<p style="margin: 5px 0;">${report.details}</p>` : ''}
                        <small style="color: #666;">Segnalato il: ${new Date(report.reported_at).toLocaleString()}</small>
                        ${report.resolved ? '<br><span style="color: green;">‚úì Risolto</span>' : ''}
                    </div>
                `).join('');
                
                // Crea un modal per mostrare i report
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'flex';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Tutti i Report</h3>
                            <button class="close-modal" onclick="this.parentElement.parentElement.parentElement.remove()">√ó</button>
                        </div>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${reports.length > 0 ? reportsHtml : '<p>Nessun report trovato.</p>'}
                        </div>
                        <div style="margin-top: 15px; text-align: center;">
                            <button class="btn btn-primary" onclick="this.parentElement.parentElement.parentElement.remove()">Chiudi</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
            } catch (error) {
                console.error('Errore nel caricamento dei report:', error);
                showNotification('Errore nel caricamento dei report.', true);
            }
        }
        
        // Funzione helper per testo dei report
        function getReasonText(reason) {
            const reasons = {
                'inappropriate': 'Contenuto inappropriato',
                'sexual': 'Contenuto sessuale',
                'fake': 'Foto non reale/falsa',
                'other': 'Altro'
            };
            return reasons[reason] || reason;
        }
        
        // Rifiuta/rimuovi una foto
        async function rejectPhoto(photoId) {
            if (!isAdminAuthenticated) {
                showNotification('Accesso admin richiesto!', true);
                return;
            }
            
            if (!confirm('Sei sicuro di voler rimuovere questa foto? Questa azione non pu√≤ essere annullata.')) {
                return;
            }
            
            try {
                // Prima ottieni l'URL dell'immagine per eliminarla dallo storage
                const { data: photo, error: fetchError } = await supabase
                    .from('photos')
                    .select('image_url')
                    .eq('id', photoId)
                    .single();
                
                if (fetchError) throw fetchError;
                
                // Estrai il nome del file dall'URL
                const imagePath = photo.image_url.split('/').pop();
                
                // Elimina l'immagine dallo storage
                const { error: storageError } = await supabase.storage
                    .from('photo-uploads')
                    .remove([imagePath]);
                
                if (storageError) {
                    console.error('Errore nell\'eliminazione dell\'immagine:', storageError);
                    // Continua comunque con l'eliminazione del record
                }
                
                // Elimina il record della foto
                const { error } = await supabase
                    .from('photos')
                    .delete()
                    .eq('id', photoId);
                
                if (error) throw error;
                
                showNotification('Foto rimossa con successo!');
                
                // Ricarica le liste
                loadReportedPhotos();
                loadSuspendedPhotos();
                loadModerationStats();
                
            } catch (error) {
                console.error('Errore durante la rimozione:', error);
                showNotification('Errore durante la rimozione. Riprova.', true);
            }
        }
        
        // ... (le altre funzioni rimangono simili al codice precedente)
        // Per brevit√†, includo solo le funzioni modificate o essenziali
        
        // Gestione passaggi
        function goToStep(step) {
            // Nascondi tutti i contenuti dei passaggi
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Aggiorna indicatori dei passaggi
            document.querySelectorAll('.step').forEach((stepEl, index) => {
                stepEl.classList.remove('active', 'completed');
                if (index + 1 < step) {
                    stepEl.classList.add('completed');
                } else if (index + 1 === step) {
                    stepEl.classList.add('active');
                }
            });
            
            // Mostra il contenuto del passaggio corrente
            document.getElementById(`step${step}-content`).classList.add('active');
            
            // Aggiorna i dati nel passaggio 3
            if (step === 3) {
                document.getElementById('confirmPreviewImage').src = document.getElementById('previewImage').src;
                document.getElementById('confirm-gender').textContent = 
                    selectedGender === 'male' ? 'üë¶ Ragazzo' : 'üëß Ragazza';
            }
        }
        
        // Selezione genere per upload
        function selectGender(gender) {
            selectedGender = gender;
            
            // Aggiorna pulsanti
            document.querySelectorAll('#step1-content .gender-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (gender === 'male') {
                document.getElementById('maleBtn').classList.add('active');
            } else {
                document.getElementById('femaleBtn').classList.add('active');
            }
            
            // Abilita pulsante Avanti
            document.getElementById('nextToStep2').disabled = false;
            
            // Aggiorna testo nel passaggio 2
            document.getElementById('current-gender').textContent = 
                gender === 'male' ? 'üë¶ Ragazzo' : 'üëß Ragazza';
        }
        
        // Selezione genere per votazione
        function selectVoteGender(gender) {
            currentVoteGender = gender;
            
            // Aggiorna pulsanti
            document.querySelectorAll('.gender-selection-vote .gender-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (gender === 'male') {
                document.getElementById('voteMaleBtn').classList.add('active');
            } else {
                document.getElementById('voteFemaleBtn').classList.add('active');
            }
            
            // Ricarica le foto per il genere selezionato
            loadPhotosForVoting();
        }
        
        // ... (altre funzioni come handleFileSelection, uploadPhoto, loadPhotosForVoting, etc.)
        // Per brevit√†, assumo che siano simili al codice precedente
        
        // Funzioni per i modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function openReportModal(photoId) {
            currentPhotoForReport = photoId;
            document.getElementById('reportModal').style.display = 'flex';
        }
        
        function showNotification(message, isError = false, type = '') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            
            if (isError) {
                notification.classList.add('error');
            } else if (type === 'info') {
                notification.classList.add('info');
            } else if (type === 'warning') {
                notification.classList.add('warning');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Per completezza, includo alcune funzioni essenziali
        // che dovrebbero essere simili al codice precedente
        
        async function loadPhotosForVoting() {
            // Implementazione simile al codice precedente
            // Filtra solo le foto con status 'active'
        }
        
        async function submitReport() {
            // Implementazione simile al codice precedente
            // Aggiunge report e aggiorna report_count
        }
        
        // ... altre funzioni necessarie
        
    </script>
</body>
</html>
